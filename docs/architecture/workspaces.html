

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Workspaces &mdash; Scale 5.4.0-snapshot documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Django/Code Base" href="django/index.html" />
    <link rel="prev" title="Triggers" href="triggers.html" />
    <link href="../_static/style.css" rel="stylesheet" type="text/css">


  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Scale
          

          
            
            <img src="../_static/scale3-transparent-128.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                5.4
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cli/index.html">Command Line Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="../algorithm_integration/index.html">Algorithm Integration into Scale</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Architecture</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="jobs/index.html">Jobs and Recipes</a></li>
<li class="toctree-l2"><a class="reference internal" href="logs.html">ElasticSearch Logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="messaging.html">Messaging System</a></li>
<li class="toctree-l2"><a class="reference internal" href="port.html">Import/Export</a></li>
<li class="toctree-l2"><a class="reference internal" href="scan.html">Scan</a></li>
<li class="toctree-l2"><a class="reference internal" href="strike.html">Strike</a></li>
<li class="toctree-l2"><a class="reference internal" href="triggers.html">Triggers</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Workspaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#workspace-configuration-specification-version-1-0">Workspace Configuration Specification Version 1.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="#host-broker">Host Broker</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nfs-broker-experimental">NFS Broker <em>(experimental)</em></a></li>
<li class="toctree-l3"><a class="reference internal" href="#s3-broker-experimental">S3 Broker <em>(experimental)</em></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="django/index.html">Django/Code Base</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rest/index.html">REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/index.html">Development</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Scale</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Architecture</a> &raquo;</li>
        
      <li>Workspaces</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/architecture/workspaces.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="workspaces">
<span id="architecture-workspaces"></span><h1>Workspaces<a class="headerlink" href="#workspaces" title="Permalink to this headline">¶</a></h1>
<p>A workspace in the Scale system is a location where files are stored (source files, product files, etc). A workspace
contains configuration specifying how files are stored into and retrieved from the workspace. Workspaces are configured
to use various <em>brokers</em>, which know how to store/retrieve files in different storage systems (e.g. NFS).</p>
<p><strong>Example workspace configuration:</strong></p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
   <span class="s2">&quot;broker&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;nfs&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nfs_path&quot;</span><span class="o">:</span> <span class="s2">&quot;host:/my/path&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <em>broker</em> value is a JSON object providing the configuration for this workspace&#8217;s broker. The <em>type</em> value indicates
that the NFS (Network File System) broker should be used for this workspace. The <em>nfs_path</em> field specifies the NFS host
and path that should be mounted in order to access the files. To see all of the options for a workspace&#8217;s configuration,
please refer to the Workspace Configuration Specification below.</p>
<div class="section" id="workspace-configuration-specification-version-1-0">
<span id="architecture-workspaces-spec"></span><h2>Workspace Configuration Specification Version 1.0<a class="headerlink" href="#workspace-configuration-specification-version-1-0" title="Permalink to this headline">¶</a></h2>
<p>A valid workspace configuration is a JSON document with the following structure:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="nx">STRING</span><span class="p">,</span>
   <span class="s2">&quot;broker&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="nx">STRING</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>version</strong>: JSON string</p>
<blockquote>
<div>The <em>version</em> is an optional string value that defines the version of the configuration used. This allows updates to
be made to the specification while maintaining backwards compatibility by allowing Scale to recognize an older
version and convert it to the current version. The default value for <em>version</em> if it is not included is the latest
version, which is currently 1.0. It is recommended, though not required, that you include the <em>version</em> so that
future changes to the specification will still accept your workspace configuration.</div></blockquote>
<p><strong>broker</strong>: JSON object</p>
<blockquote>
<div><p>The <em>broker</em> is a JSON object that defines the broker that the workspace should use for retrieving and storing
files. The <em>broker</em> JSON object always has the following field:</p>
<p><strong>type</strong>: JSON string</p>
<blockquote>
<div><p>The <em>type</em> is a required string that specifies the type of the broker to use. The other fields that configure
the broker are based upon the type of the broker in the <em>type</em> field. The valid broker types are:</p>
<p><strong>host</strong></p>
<blockquote>
<div>A &#8220;host&#8221; broker mounts a local directory from the host into the job&#8217;s container. Usually this local
directory is a shared file system that has been mounted onto the host.</div></blockquote>
<p><strong>nfs</strong></p>
<blockquote>
<div>An &#8220;nfs&#8221; broker utilizes an NFS (Network File System) for file storage</div></blockquote>
<p><strong>s3</strong></p>
<blockquote>
<div>An &#8220;s3&#8221; broker utilizes the Amazon Web Services (AWS) Simple Storage Service (S3) for file storage</div></blockquote>
<p>Additional <em>broker</em> fields may be required depending on the type of broker selected. See below for more
information on each broker type.</p>
</div></blockquote>
</div></blockquote>
</div>
<div class="section" id="host-broker">
<h2>Host Broker<a class="headerlink" href="#host-broker" title="Permalink to this headline">¶</a></h2>
<p>The host broker mounts a local directory from the host into the job&#8217;s container. This local directory should be a shared
file system that has been mounted onto all hosts in the cluster. All hosts must have the same shared file system mounted
at the same location for this broker to work properly.</p>
<p><strong>Permissions</strong></p>
<p>The Scale Docker containers run with a UID and GID of 7498. To ensure that permissions are appropriately handled within
Docker, make sure that your host&#8217;s local directory is owned by a user/group with UID/GID of 7498/7498.</p>
<p><strong>Security</strong></p>
<p>There are potential security risks involved with mounting a host directory into a Docker container. It is recommended
that you use another broker type if possible.</p>
<p>Example host broker configuration:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
   <span class="s2">&quot;broker&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;host&quot;</span><span class="p">,</span>
      <span class="s2">&quot;host_path&quot;</span><span class="o">:</span> <span class="s2">&quot;/the/absolute/host/path&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The host broker requires one additional field in its configuration:</p>
<p><strong>host_path</strong>: JSON string</p>
<blockquote>
<div>The <em>host_path</em> is a required string that specifies the absolute path of the host&#8217;s local directory that should be
mounted into a job&#8217;s container in order to access the workspace&#8217;s files.</div></blockquote>
</div>
<div class="section" id="nfs-broker-experimental">
<h2>NFS Broker <em>(experimental)</em><a class="headerlink" href="#nfs-broker-experimental" title="Permalink to this headline">¶</a></h2>
<p>The NFS broker mounts a remote network file system volume into the job&#8217;s container.</p>
<p><strong>Plugin Required</strong></p>
<p>In order to use Scale&#8217;s NFS broker, you must install and run the Netshare Docker plugin. Please see
<a class="reference external" href="http://netshare.containx.io/">http://netshare.containx.io/</a> for more information.</p>
<p><strong>Permissions</strong></p>
<p>The Scale Docker containers run with a UID and GID of 7498. To ensure that permissions are appropriately handled within
Docker, make sure that the directories in your NFS file volume are owned by a user/group with UID/GID of 7498/7498.</p>
<p>Example NFS broker configuration:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
   <span class="s2">&quot;broker&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;nfs&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nfs_path&quot;</span><span class="o">:</span> <span class="s2">&quot;host:/my/path&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The NFS broker requires one additional field in its configuration:</p>
<p><strong>nfs_path</strong>: JSON string</p>
<blockquote>
<div>The <em>nfs_path</em> is a required string that specifies the remote NFS path to use for storing and retrieving the
workspace files. It should be in the format <em>host:/path</em>.</div></blockquote>
</div>
<div class="section" id="s3-broker-experimental">
<h2>S3 Broker <em>(experimental)</em><a class="headerlink" href="#s3-broker-experimental" title="Permalink to this headline">¶</a></h2>
<p>The S3 broker references a storage location that exists as an S3 bucket in your AWS account. Please take note of the
bucket name, which is typically of the form <em>my_name.domain.com</em> since bucket names must be globally unique
(See <a class="reference external" href="http://docs.aws.amazon.com/AmazonS3/latest/dev/BucketRestrictions.html">Bucket Restrictions</a>). The bucket must be configured for read and/or write access through an appropriate IAM
account (Identity and Access Management). Once the IAM account is created and granted permissions to the bucket, then
there are two ways to handle authentication. IAM roles can be used to automatically grant permissions to the EC2
executing the broker operations (See <a class="reference external" href="http://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html">AWS Roles</a>). This method is preferred because no secret keys are required.
Alternatively, an <em>ACCESS KEY ID</em> and <em>SECRET ACCESS KEY</em> can be generated and used with this broker
(See <a class="reference external" href="http://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSGettingStartedGuide/AWSCredentials.html">AWS Credentials</a>). These tokens allow 3rd party software to access resources on behalf of the associated account.</p>
<p><strong>Security</strong></p>
<p>A dedicated IAM account should be used rather than the root AWS account to limit the risk of damage if a leak were to
occur and similarly the IAM account should be given the minimum possible permissions needed to work with the bucket. The
access tokens should also be changed periodically to further protect against leaks.</p>
<p>While this broker is in the experimental phase, the access keys are currently stored in plain text within the Scale
database and exposed via the REST interface. A future version will maintain these values using a more appropriate
encrypted store service.</p>
<p>Example S3 broker configuration:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="s2">&quot;version&quot;</span><span class="o">:</span> <span class="s2">&quot;1.0&quot;</span><span class="p">,</span>
   <span class="s2">&quot;broker&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;s3&quot;</span><span class="p">,</span>
      <span class="s2">&quot;bucket_name&quot;</span><span class="o">:</span> <span class="s2">&quot;my_bucket.domain.com&quot;</span><span class="p">,</span>
      <span class="s2">&quot;credentials&quot;</span><span class="o">:</span> <span class="p">{</span>
         <span class="s2">&quot;access_key_id&quot;</span><span class="o">:</span> <span class="s2">&quot;AKIAIOSFODNN7EXAMPLE&quot;</span><span class="p">,</span>
         <span class="s2">&quot;secret_access_key&quot;</span><span class="o">:</span> <span class="s2">&quot;wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY&quot;</span>
      <span class="p">},</span>
      <span class="s2">&quot;host_path&quot;</span><span class="o">:</span> <span class="s2">&quot;/my_bucket&quot;</span><span class="p">,</span>
      <span class="s2">&quot;region_name&quot;</span><span class="o">:</span> <span class="s2">&quot;us-east-1&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The S3 broker requires the following additional fields in its configuration:</p>
<p><strong>bucket_name</strong>: JSON string</p>
<blockquote>
<div>The <em>bucket_name</em> is a required string that specifies the globally unique name of a storage bucket within S3. The
bucket should be created before attempting to use it here.</div></blockquote>
<p><strong>credentials</strong></p>
<blockquote>
<div><p>The <em>credentials</em> is a JSON object that provides the necessary information to access the bucket. This attribute
should be omitted when using IAM role-based security. If it is included for key-based security, then both
sub-attributes must be included. An IAM account should be created and granted the appropriate permissions to the
bucket before attempting to use it here.</p>
<p><strong>access_key_id</strong>: JSON string</p>
<blockquote>
<div>The <em>access_key_id</em> is a unique identifier for the user account in IAM that will be used as a proxy for read and
write operations within Scale.</div></blockquote>
<p><strong>secret_access_key</strong>: JSON string</p>
<blockquote>
<div>The <em>secret_access_key</em> is a generated token that the system can use to prove it should be able to make requests
on behalf of the associated IAM account without requiring the actual password used by that account.</div></blockquote>
</div></blockquote>
<p><strong>host_path</strong>: JSON string</p>
<blockquote>
<div>The <em>host_path</em> is an optional string that adds S3 workspace support for locally mounted buckets and partial file
read-only access. If a FUSE file system (such as s3fs or goofys) mounts the S3 bucket at the <em>host_path</em> location on
all nodes, an alternative to downloading large files is available to jobs that use only portions of a file. The job
interface <em>must</em> indicate <em>partial</em> equal to <em>true</em> for any input files to take advantage of <em>host_path</em>. Only read
operations are performed using the mount, all write operations will use the S3 REST API.</div></blockquote>
<p><strong>region_name</strong>: JSON string</p>
<blockquote>
<div>The <em>region_name</em> is an optional string that specifies the AWS region where the S3 bucket is located. This is not
always required, as environment variables or configuration files could set the default region, but it is a highly
recommended setting for explicitly indicating the bucket region.</div></blockquote>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="django/index.html" class="btn btn-neutral float-right" title="Django/Code Base" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="triggers.html" class="btn btn-neutral" title="Triggers" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, NGA.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'5.4.0-snapshot',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  <script type="text/javascript">
      jQuery(function () {
          
          SphinxRtdTheme.Navigation.enableSticky();
          
      });
  </script> 

</body>
</html>